import { useSelector } from "react-redux";


function TopSection({data}) {
    const userId=useSelector((state)=>  state.loginuser.data.id)
    const user=useSelector((state)=>state.loginuser.data)


    const assignmentData = data?.flatMap(item => 
        item.assignments
            ?.filter(assignment => assignment.assign_user_id === userId)
            .map(assignment => ({ 
                ...assignment,  
                req_user_id: item.user_id,
                project_code:item.project_code,
                priority:item.priority,
                project_created_at:item.created_at,
                duedate:item.due_date
            })) || []
    ) || [];
    
    const completedCount = assignmentData.filter(project => project.status === "completed").length;




    return (
        <div className='col-12 d-flex justify-content-start gap-2 flex-column w-auto mx-auto text-center' >
            <div className='ts-time' >
                <span>{getCurrentDate()}</span>
            </div>
            <div className='ts-name' >
                <span>
                    Greetings, {user.name}
                </span>
            </div>
            <div className='ts-filter gap-2 mx-auto'  >
                <select className="w-auto">
                    <option defaultValue={"My week"}>My week</option>
                    <option defaultValue={"My Month"}>My Month</option>
                </select>
                <span className='' >|</span>
                <div className='d-flex justify-content-between gap-2' >
                    <span className='my-auto' >
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
                            <path fillRule="evenodd" clipRule="evenodd" d="M17.539 5.71313L8.25217 15L3 9.74783L3.71313 9.0347L8.25217 13.5737L16.8259 5L17.539 5.71313Z" fill="#252525" />
                        </svg>
                    </span>
                    <span className='my-auto' >{completedCount} Tasks Completed</span>
                </div>
                <span>|</span>
                <div className='d-flex justify-content-between gap-2' >
                    <span className='my-auto' >
                        <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 20 20" fill="none">
                            <path d="M11.5991 10.1649C10.9853 10.1649 10.3853 9.98289 9.87495 9.64188C9.36459 9.30087 8.96682 8.81618 8.73193 8.24909C8.49703 7.68201 8.43557 7.05801 8.55532 6.456C8.67507 5.85399 8.97064 5.30101 9.40467 4.86699C9.83869 4.43296 10.3917 4.13739 10.9937 4.01764C11.5957 3.89789 12.2197 3.95935 12.7868 4.19425C13.3539 4.42914 13.8385 4.82691 14.1796 5.33727C14.5206 5.84763 14.7026 6.44765 14.7026 7.06146C14.7026 7.88454 14.3756 8.67392 13.7936 9.25593C13.2116 9.83794 12.4222 10.1649 11.5991 10.1649ZM11.5991 5.19939C11.2309 5.19939 10.8708 5.3086 10.5646 5.5132C10.2584 5.71781 10.0197 6.00863 9.87881 6.34887C9.73787 6.68912 9.701 7.06352 9.77285 7.42473C9.8447 7.78593 10.022 8.11772 10.2825 8.37814C10.5429 8.63855 10.8747 8.8159 11.2359 8.88775C11.5971 8.9596 11.9715 8.92272 12.3117 8.78178C12.652 8.64085 12.9428 8.40218 13.1474 8.09597C13.352 7.78975 13.4612 7.42974 13.4612 7.06146C13.4612 6.56761 13.265 6.09398 12.9158 5.74478C12.5666 5.39557 12.093 5.19939 11.5991 5.19939ZM17.3922 15.958C17.2283 15.9559 17.0717 15.8898 16.9557 15.7738C16.8398 15.6579 16.7737 15.5013 16.7716 15.3373C16.7716 13.7235 15.8943 12.6477 11.5991 12.6477C7.30397 12.6477 6.42672 13.7235 6.42672 15.3373C6.42672 15.5019 6.36133 15.6598 6.24493 15.7762C6.12853 15.8926 5.97065 15.958 5.80603 15.958C5.64142 15.958 5.48354 15.8926 5.36714 15.7762C5.25074 15.6598 5.18534 15.5019 5.18534 15.3373C5.18534 11.4063 9.67914 11.4063 11.5991 11.4063C13.5191 11.4063 18.0129 11.4063 18.0129 15.3373C18.0108 15.5013 17.9447 15.6579 17.8288 15.7738C17.7128 15.8898 17.5562 15.9559 17.3922 15.958ZM6.89845 10.8353H6.63362C5.97515 10.7716 5.36894 10.449 4.94834 9.93836C4.52774 9.42774 4.32721 8.77096 4.39086 8.11249C4.45451 7.45402 4.77713 6.84781 5.28775 6.42721C5.79837 6.00661 6.45515 5.80608 7.11362 5.86973C7.19805 5.87336 7.28085 5.89419 7.35695 5.93095C7.43304 5.96771 7.50083 6.01962 7.55615 6.0835C7.61148 6.14738 7.65318 6.22188 7.67869 6.30245C7.70421 6.38301 7.713 6.46794 7.70454 6.55202C7.69607 6.6361 7.67053 6.71757 7.62946 6.79143C7.5884 6.8653 7.53269 6.93 7.46574 6.98157C7.3988 7.03314 7.32202 7.07049 7.24013 7.09135C7.15823 7.1122 7.07294 7.11611 6.98948 7.10284C6.82793 7.08673 6.66479 7.10334 6.5098 7.15169C6.35481 7.20003 6.21116 7.27912 6.08741 7.38422C5.96173 7.4856 5.85748 7.61099 5.78075 7.75307C5.70403 7.89516 5.65635 8.0511 5.64052 8.2118C5.6234 8.37452 5.63884 8.53901 5.68594 8.6957C5.73303 8.85239 5.81084 8.99814 5.91482 9.12446C6.0188 9.25078 6.14689 9.35515 6.2916 9.43148C6.43632 9.5078 6.59479 9.55457 6.75776 9.56904C7.02717 9.59209 7.29688 9.52829 7.52741 9.38697C7.66789 9.30028 7.83705 9.27293 7.99768 9.31096C8.15832 9.34898 8.29727 9.44926 8.38397 9.58973C8.47066 9.73021 8.49801 9.89937 8.45998 10.06C8.42196 10.2206 8.32168 10.3596 8.18121 10.4463C7.79737 10.6911 7.35361 10.8257 6.89845 10.8353ZM2.49569 15.3373C2.33174 15.3352 2.17511 15.2691 2.05917 15.1532C1.94323 15.0372 1.87714 14.8806 1.875 14.7166C1.875 12.4821 2.47086 10.9925 5.39224 10.9925C5.55686 10.9925 5.71473 11.0579 5.83114 11.1743C5.94754 11.2907 6.01293 11.4486 6.01293 11.6132C6.01293 11.7778 5.94754 11.9357 5.83114 12.0521C5.71473 12.1685 5.55686 12.2339 5.39224 12.2339C3.44741 12.2339 3.11638 12.8546 3.11638 14.7166C3.11424 14.8806 3.04815 15.0372 2.93221 15.1532C2.81627 15.2691 2.65964 15.3352 2.49569 15.3373Z" fill="#252525" />
                        </svg>
                    </span>
                    <span className='my-auto' >{user.assigned_projects!==null && user.assigned_projects ?user.assigned_projects.length:0} Collaboration(s)</span>
                </div>

            </div>
        </div>
    )
}

export default TopSection


function getCurrentDate() {
    const options = { weekday: 'long', month: 'long', day: 'numeric' };
    const currentDate = new Date();
    return currentDate.toLocaleDateString('en-US', options);
}

