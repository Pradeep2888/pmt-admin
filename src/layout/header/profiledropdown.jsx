import { Link, useNavigate } from 'react-router-dom';
import Cookies from 'js-cookie';
import { useDispatch, useSelector } from 'react-redux';
import { useEffect } from 'react';
import { fetchLoginUser, resetUser } from '../../features/user/loginuserSlice';

function Profiledropdown() {
  const navigate = useNavigate();
  const dispatch = useDispatch()
  const userId = Cookies.get('adminId')
  const user = useSelector((state) => state.loginuser.data) || {};



  useEffect(() => {
    if (userId && !user) {
      dispatch(fetchLoginUser(userId));
    }
  }, [dispatch, userId, user]);


  const handleLogout = () => {
    Cookies.remove('adminToken');
    Cookies.remove('adminId');
    dispatch(resetUser());
    navigate('/login');
  };

  const profileImage = user?.image
    ? user.image
    : `https://avatar.iran.liara.run/username?username=${user?.name || "Loading..."}`;


  return (
    <div className="dropdown dropstart position-relative d-flex">
      <div type="button" className="dropdown-toggle d-flex justify-content-between gap-2 my-auto" id="dropdownMenuButton2" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-controls="dropdownMenu">

        <img src={user !== undefined && user.image !== null ? user.image : `https://avatar.iran.liara.run/username?username=${user ? user.name : "Loading..."}`} style={{ width: "26px", borderRadius: "50%", border: "2px solid #fff" }} />
        <span className='nav-profile-icon' >
          <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" role="img">
            <path d="M12 16L6 10L8.00094 8L12 12L15.9991 8L18 10L12 16Z" fill="white" />
          </svg>
        </span>
      </div>
      <ul className="dropdown-menu dropdown-menu-profile position-absolute" aria-labelledby="dropdownMenuButton2">
        <li className=' text-center px-3' >
          <p className='demo-heading mx-auto m-0 my-2'>{user.name}</p>
          <p className='m-0 d-m-p-text1 mb-1 ' >{user.email}</p>
        </li>

        <li className='mt-3' style={{ borderBottom: "1px solid #3954A5" }}  ><div className=' d-flex justify-content-start gap-2 text-decoration-none drop-down-list w-100' >
          <div className='  drop-down-list-icon' >
            <svg xmlns="http://www.w3.org/2000/svg" role="img" width="20" height="21" viewBox="0 0 20 21" fill="none">
              <path d="M14.9998 11.3317H10.8332V15.4984C10.8332 15.7194 10.7454 15.9313 10.5891 16.0876C10.4328 16.2439 10.2209 16.3317 9.99984 16.3317C9.77882 16.3317 9.56686 16.2439 9.41058 16.0876C9.2543 15.9313 9.1665 15.7194 9.1665 15.4984V11.3317H4.99984C4.77882 11.3317 4.56686 11.2439 4.41058 11.0876C4.2543 10.9313 4.1665 10.7194 4.1665 10.4984C4.1665 10.2774 4.2543 10.0654 4.41058 9.90912C4.56686 9.75284 4.77882 9.66504 4.99984 9.66504H9.1665V5.49837C9.1665 5.27736 9.2543 5.0654 9.41058 4.90912C9.56686 4.75284 9.77882 4.66504 9.99984 4.66504C10.2209 4.66504 10.4328 4.75284 10.5891 4.90912C10.7454 5.0654 10.8332 5.27736 10.8332 5.49837V9.66504H14.9998C15.2209 9.66504 15.4328 9.75284 15.5891 9.90912C15.7454 10.0654 15.8332 10.2774 15.8332 10.4984C15.8332 10.7194 15.7454 10.9313 15.5891 11.0876C15.4328 11.2439 15.2209 11.3317 14.9998 11.3317Z" fill="#3954A5" />
            </svg>
          </div>
          <p className=' my-auto drop-down-list-text' >New Workspace</p>
        </div>
        </li>
        <li  ><Link to={"/profile"} className='d-flex justify-content-start gap-2 text-decoration-none drop-down-list w-100' >
          <div className='  drop-down-list-icon' >
            <svg xmlns="http://www.w3.org/2000/svg" role="img" width="20" height="21" viewBox="0 0 20 21" fill="none">
              <path d="M10.0402 17.3002C6.28023 17.3002 3.24023 14.2602 3.24023 10.5002C3.24023 6.7402 6.28023 3.7002 10.0402 3.7002C13.8002 3.7002 16.8402 6.7402 16.8402 10.5002C16.8402 14.2602 13.7602 17.3002 10.0402 17.3002ZM10.0402 4.5002C6.72023 4.5002 4.04023 7.1802 4.04023 10.5002C4.04023 13.8202 6.72023 16.5002 10.0402 16.5002C13.3602 16.5002 16.0402 13.8202 16.0402 10.5002C16.0402 7.1802 13.3202 4.5002 10.0402 4.5002Z" fill="#3954A5" />
              <path d="M6.1199 15.4198L5.3999 15.0998C5.5999 14.6198 6.2399 14.3398 6.9199 14.0198C7.5999 13.6998 8.4399 13.3398 8.4399 12.8998V12.2998C8.1999 12.0998 7.7999 11.6598 7.7199 11.0198C7.5199 10.8198 7.1999 10.4598 7.1999 9.9798C7.1999 9.69981 7.3199 9.4598 7.3999 9.2998C7.3199 8.9798 7.2399 8.3798 7.2399 7.8998C7.2399 6.3398 8.3199 5.2998 10.0399 5.2998C10.5199 5.2998 11.1199 5.4198 11.4399 5.7798C12.1999 5.9398 12.8399 6.8198 12.8399 7.8998C12.8399 8.5798 12.7199 9.1398 12.6399 9.4198C12.7199 9.5398 12.7999 9.73981 12.7999 9.9798C12.7999 10.4998 12.5199 10.8598 12.2799 11.0198C12.1999 11.6598 11.8399 12.0598 11.5999 12.2598V12.8998C11.5999 13.2598 12.3199 13.5398 12.9599 13.7798C13.7199 14.0598 14.5199 14.3798 14.7999 15.0198L14.0399 15.2998C13.9199 14.9798 13.2799 14.7398 12.6799 14.5398C11.7999 14.2198 10.7999 13.8598 10.7999 12.9398V11.8998L10.9999 11.7798C10.9999 11.7798 11.4799 11.4598 11.4799 10.8198V10.5398L11.7199 10.4198C11.7599 10.4198 11.9599 10.2998 11.9599 9.9798C11.9599 9.89981 11.8799 9.7798 11.8399 9.7398L11.6799 9.5798L11.7599 9.37981C11.7599 9.37981 11.9599 8.7398 11.9599 7.9398C11.9599 7.1798 11.5199 6.6198 11.1599 6.6198H10.9199L10.7999 6.4198C10.7999 6.2598 10.5199 6.0998 10.0399 6.0998C8.7999 6.0998 8.0399 6.7798 8.0399 7.8998C8.0399 8.4198 8.2399 9.2998 8.2399 9.2998L8.2799 9.4998L8.1199 9.6998C8.0799 9.6998 7.9999 9.81981 7.9999 9.9798C7.9999 10.1798 8.2399 10.4198 8.3599 10.4998L8.5199 10.6198V10.8198C8.5199 11.4198 9.0399 11.7398 9.0399 11.7798L9.2399 11.8998V12.9398C9.2399 13.8998 8.1999 14.3798 7.2399 14.7798C6.7999 14.9398 6.1999 15.2198 6.1199 15.4198Z" fill="#3954A5" />
            </svg>
          </div>
          <p className=' my-auto drop-down-list-text'  >Profile</p>
        </Link>
        </li>
        <li  ><div className=' d-flex justify-content-start gap-2 text-decoration-none drop-down-list w-100' >
          <div className='  drop-down-list-icon' >
            <svg xmlns="http://www.w3.org/2000/svg" role="img" width="20" height="21" viewBox="0 0 20 21" fill="none">
              <path d="M10.5 17.9468H9.41664C9.25473 17.9471 9.09728 17.8938 8.96885 17.7952C8.84042 17.6966 8.74822 17.5583 8.70664 17.4018L8.06164 15.041L5.97831 16.2368C5.83863 16.3164 5.67678 16.3483 5.51734 16.3275C5.35791 16.3067 5.20961 16.2345 5.09497 16.1218L4.32414 15.356C4.20935 15.2416 4.13546 15.0926 4.11391 14.932C4.09237 14.7714 4.12438 14.6082 4.20497 14.4676L5.42914 12.3468L5.42414 12.3335L3.10164 11.711C2.9453 11.6694 2.80708 11.5773 2.70851 11.4491C2.60994 11.3208 2.55655 11.1636 2.55664 11.0018V9.91678C2.55663 9.75538 2.60987 9.59848 2.70811 9.47042C2.80634 9.34235 2.94408 9.25027 3.09997 9.20845L5.46581 8.56095L4.26664 6.47595C4.18679 6.33587 4.15505 6.17349 4.17627 6.01365C4.19749 5.85382 4.27051 5.70534 4.38414 5.59095L5.14914 4.82595C5.26337 4.71237 5.41164 4.63932 5.5713 4.61795C5.73097 4.59658 5.89323 4.62808 6.03331 4.70762L8.15997 5.92845H8.16997L8.79081 3.60345C8.8322 3.44696 8.9242 3.30855 9.05248 3.20982C9.18076 3.11109 9.3381 3.05757 9.49997 3.05762H10.5833C10.7453 3.05739 10.9029 3.11082 11.0313 3.20957C11.1598 3.30831 11.2519 3.44682 11.2933 3.60345L11.9283 5.96845L14.0191 4.76762C14.1587 4.68806 14.3204 4.65624 14.4797 4.677C14.639 4.69776 14.7871 4.76996 14.9016 4.88262L15.6733 5.64845C15.7885 5.76276 15.8626 5.91207 15.8838 6.07298C15.9051 6.23389 15.8724 6.3973 15.7908 6.53762L14.5691 8.64762L14.5758 8.66595L16.8975 9.28762C17.0537 9.32932 17.1917 9.42146 17.2901 9.54971C17.3885 9.67796 17.4418 9.83513 17.4416 9.99678V11.0801C17.4419 11.242 17.3886 11.3995 17.29 11.5279C17.1914 11.6563 17.0531 11.7485 16.8966 11.7901L14.5325 12.4351L15.7316 14.5226C15.8124 14.6626 15.8446 14.8253 15.8234 14.9855C15.8022 15.1457 15.7286 15.2944 15.6141 15.4085L14.85 16.1726C14.7352 16.2858 14.5866 16.3586 14.4267 16.3798C14.2669 16.401 14.1045 16.3695 13.9641 16.2901L11.8483 15.0718L11.8333 15.0835L11.2125 17.4043C11.1697 17.5604 11.0767 17.698 10.948 17.7961C10.8192 17.8941 10.6618 17.9471 10.5 17.9468ZM9.49164 17.1135H10.4241L11.0391 14.8168C11.0693 14.7061 11.1248 14.604 11.2011 14.5184C11.2775 14.4328 11.3726 14.3661 11.4791 14.3235L11.5908 14.2801C11.6931 14.2395 11.8032 14.2226 11.913 14.2308C12.0227 14.2391 12.1291 14.2722 12.2241 14.3276L14.3158 15.5318L14.9733 14.8743L13.7875 12.8093C13.7312 12.7113 13.6983 12.6017 13.6914 12.489C13.6844 12.3762 13.7036 12.2634 13.7475 12.1593L13.7908 12.0551C13.8341 11.9518 13.9005 11.8598 13.9848 11.7861C14.0692 11.7125 14.1693 11.6591 14.2775 11.6301L16.6108 11.006V10.0726L14.315 9.45845C14.2042 9.42817 14.102 9.37259 14.0164 9.29609C13.9308 9.21959 13.8641 9.12427 13.8216 9.01762L13.7783 8.90762C13.7379 8.80489 13.7211 8.69436 13.7293 8.58427C13.7376 8.47417 13.7705 8.36736 13.8258 8.27178L15.0333 6.18178L14.3666 5.52345L12.3 6.71095C12.2031 6.76671 12.0948 6.79961 11.9833 6.80712C11.8718 6.81463 11.7601 6.79656 11.6566 6.75428L11.5608 6.71512C11.4562 6.6718 11.363 6.60512 11.2881 6.52018C11.2133 6.43525 11.1589 6.33432 11.1291 6.22512L10.5058 3.88678H9.57664L8.96164 6.18845C8.93205 6.30156 8.87585 6.40596 8.79771 6.49294C8.71958 6.57992 8.62178 6.64695 8.51247 6.68845L8.41247 6.72595C8.3112 6.7653 8.20238 6.78139 8.09406 6.77303C7.98573 6.76466 7.88067 6.73205 7.78664 6.67762L5.68497 5.46845L5.02747 6.12595L6.21247 8.18928C6.26854 8.2881 6.30116 8.39848 6.30781 8.51191C6.31445 8.62533 6.29495 8.73876 6.25081 8.84345L6.20831 8.94345C6.16443 9.04474 6.09825 9.13481 6.0147 9.20696C5.93116 9.2791 5.83241 9.33146 5.72581 9.36012L3.39247 9.99179V10.926L5.68997 11.541C5.80022 11.571 5.90203 11.6261 5.98746 11.702C6.07289 11.7779 6.13963 11.8725 6.18247 11.9785L6.22247 12.0793C6.26473 12.1826 6.28257 12.2942 6.27462 12.4055C6.26667 12.5168 6.23314 12.6247 6.17664 12.721L4.96497 14.8176L5.63164 15.4768L7.68997 14.2943C7.78885 14.2375 7.89961 14.2045 8.01346 14.198C8.1273 14.1915 8.2411 14.2116 8.34581 14.2568L8.43414 14.2935C8.54093 14.3351 8.63634 14.4014 8.71253 14.487C8.78872 14.5726 8.84354 14.6751 8.87247 14.786L9.49164 17.1135Z" fill="#3954A5" />
              <path d="M10 13C9.50555 13 9.0222 12.8534 8.61108 12.5787C8.19995 12.304 7.87952 11.9135 7.6903 11.4567C7.50108 10.9999 7.45157 10.4972 7.54804 10.0123C7.6445 9.52732 7.8826 9.08187 8.23223 8.73223C8.58187 8.3826 9.02732 8.1445 9.51228 8.04804C9.99723 7.95157 10.4999 8.00108 10.9567 8.1903C11.4135 8.37952 11.804 8.69995 12.0787 9.11108C12.3534 9.5222 12.5 10.0055 12.5 10.5C12.5 11.163 12.2366 11.7989 11.7678 12.2678C11.2989 12.7366 10.663 13 10 13ZM10 8.83333C9.67037 8.83333 9.34813 8.93108 9.07405 9.11422C8.79997 9.29735 8.58635 9.55765 8.4602 9.8622C8.33406 10.1667 8.30105 10.5019 8.36536 10.8252C8.42967 11.1485 8.5884 11.4454 8.82149 11.6785C9.05458 11.9116 9.35155 12.0703 9.67485 12.1346C9.99815 12.199 10.3333 12.1659 10.6378 12.0398C10.9424 11.9137 11.2026 11.7 11.3858 11.426C11.5689 11.1519 11.6667 10.8296 11.6667 10.5C11.6667 10.058 11.4911 9.63405 11.1785 9.32149C10.866 9.00893 10.442 8.83333 10 8.83333Z" fill="#3954A5" />
            </svg>
          </div>
          <p className=' my-auto drop-down-list-text' >Settings</p>
        </div>
        </li>
        <li style={{ borderBottom: "1px solid #3954A5" }} ><Link to="/user/create/new" className=' d-flex justify-content-start gap-2 text-decoration-none drop-down-list w-100' >
          <div className='  drop-down-list-icon' >
            <svg xmlns="http://www.w3.org/2000/svg" role="img" width="20" height="21" viewBox="0 0 20 21" fill="none">
              <path d="M14.9998 11.3317H10.8332V15.4984C10.8332 15.7194 10.7454 15.9313 10.5891 16.0876C10.4328 16.2439 10.2209 16.3317 9.99984 16.3317C9.77882 16.3317 9.56686 16.2439 9.41058 16.0876C9.2543 15.9313 9.1665 15.7194 9.1665 15.4984V11.3317H4.99984C4.77882 11.3317 4.56686 11.2439 4.41058 11.0876C4.2543 10.9313 4.1665 10.7194 4.1665 10.4984C4.1665 10.2774 4.2543 10.0654 4.41058 9.90912C4.56686 9.75284 4.77882 9.66504 4.99984 9.66504H9.1665V5.49837C9.1665 5.27736 9.2543 5.0654 9.41058 4.90912C9.56686 4.75284 9.77882 4.66504 9.99984 4.66504C10.2209 4.66504 10.4328 4.75284 10.5891 4.90912C10.7454 5.0654 10.8332 5.27736 10.8332 5.49837V9.66504H14.9998C15.2209 9.66504 15.4328 9.75284 15.5891 9.90912C15.7454 10.0654 15.8332 10.2774 15.8332 10.4984C15.8332 10.7194 15.7454 10.9313 15.5891 11.0876C15.4328 11.2439 15.2209 11.3317 14.9998 11.3317Z" fill="#3954A5" />
            </svg>
          </div>
          <p className=' my-auto drop-down-list-text' >Add another account</p>
        </Link>
        </li>

        <li><div style={{ cursor: "pointer" }} className=' d-flex justify-content-start gap-2 text-decoration-none drop-down-list w-100' onClick={handleLogout}  >
          <div className='  drop-down-list-icon' >
            <svg xmlns="http://www.w3.org/2000/svg" role="img" width="20" height="21" viewBox="0 0 20 21" fill="none">
              <path fillRule="evenodd" clipRule="evenodd" d="M12.6988 13.9002C12.6066 13.986 12.5328 14.0895 12.4815 14.2045C12.4303 14.3195 12.4027 14.4437 12.4005 14.5695C12.3983 14.6954 12.4214 14.8205 12.4686 14.9372C12.5157 15.0539 12.5859 15.16 12.675 15.249C12.764 15.338 12.87 15.4082 12.9868 15.4554C13.1035 15.5025 13.2285 15.5257 13.3544 15.5234C13.4803 15.5212 13.6044 15.4937 13.7194 15.4424C13.8344 15.3912 13.9379 15.3173 14.0238 15.2252L18.0863 11.1627L18.75 10.5002L18.0875 9.8377L14.025 5.7752C13.8483 5.60434 13.6115 5.50973 13.3657 5.51175C13.1199 5.51377 12.8847 5.61225 12.7108 5.78599C12.5369 5.95973 12.4382 6.19482 12.4359 6.44063C12.4337 6.68644 12.5281 6.9233 12.6988 7.1002L15.1612 9.5627H2.1875C1.93886 9.5627 1.7004 9.66147 1.52459 9.83728C1.34877 10.0131 1.25 10.2516 1.25 10.5002C1.25 10.7488 1.34877 10.9873 1.52459 11.1631C1.7004 11.3389 1.93886 11.4377 2.1875 11.4377H15.1612L12.6988 13.9002Z" fill="#3954A5" />
            </svg>
          </div>
          <p className=' my-auto drop-down-list-text' >Log out</p>
        </div>
        </li>

      </ul>
    </div>
  )
}

export default Profiledropdown
